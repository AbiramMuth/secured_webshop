<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administrateur</title>
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <header>
      <nav>
        <ul>
          <li><a href="admin.html">Accueil</a></li>
          <li><a href="profil.html">Profil</a></li>
          <li><a href="login.html">Déconnexion</a></li>
        </ul>
      </nav>
    </header>

    <h1>Gestion des utilisateurs</h1>

    <!-- Formulaire de recherche -->
    <input type="text" id="search-email" placeholder="Rechercher par email" />
    <button onclick="searchUsers()">Rechercher</button>

    <h2>Liste des utilisateurs</h2>
    <ul id="user-list"></ul>

    <script>
      // Charger tous les utilisateurs au chargement de la page
      document.addEventListener("DOMContentLoaded", loadUsers);

      // Ajouter un écouteur sur l'input pour recherche en temps réel
      document
        .getElementById("search-email")
        .addEventListener("input", searchUsers);

      function searchUsers() {
        const email = document.getElementById("search-email").value.trim();

        if (email === "") {
          loadUsers(); // Recharger tous les utilisateurs si champ vide
          return;
        }

        fetch(`/user/admin/users/search?email=${email}`)
          .then((response) => response.json())
          .then((data) => {
            displayUsers(data);
          })
          .catch((error) => console.error("Erreur:", error));
      }

      function displayUsers(users) {
        const userList = document.getElementById("user-list");
        userList.innerHTML = ""; // Vider la liste actuelle

        if (users.length === 0) {
          userList.innerHTML = "<li>Aucun utilisateur trouvé</li>";
          return;
        }

        users.forEach((user) => {
          const li = document.createElement("li");
          li.textContent = `Email: ${user.email}, Rôle: ${user.role}`;
          userList.appendChild(li);
        });
      }

      function loadUsers() {
        fetch("/user/admin/users")
          .then((response) => response.json())
          .then((data) => {
            displayUsers(data);
          })
          .catch((error) => console.error("Erreur:", error));
      }
    </script>
  </body>
</html>
